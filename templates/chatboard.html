<!DOCTYPE html>
<html lang="en" ng-app="TestApp">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <title>Discord UI Clone</title>
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', path='/assets/favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/style/style-chatboardv2.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', path='/style/style-setting.css') }}">
    <!-- <link rel="stylesheet" href="{{ url_for('static', path='/style/style-chatboard-bak.css') }}"> -->
    <script src="/static/script/jquery.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
</head>

<body ng-controller="testCtrl">
    <noscript>Please enable JavaScript to access this website.</noscript>
    
    <!-- Setting -->
    <div class="settpage" id="settpage">
        <section class="container_setting">
    
            <div class="column1">
                <div class="section">
                <div class="section_black"></div>
                <div class="section_s">
                <a style="font-family:Mukta"><b>USER SETTING</b></a>
                    <div class="btn_a">
                        <li><button class="btn_s active"><a href="#">My Account</a></button></li>
                        <li><button class="btn_s"><a href="#">Profiles</a></button></li>
                        <!-- <li><button class="btn_s "><a href="#">Privacy & Safety</a></button></li>
                        <li><button class="btn_s"><a href="#">Authorized Apps</a></button></li>
                        <li><button class="btn_s"><a href="#">Devices</a></button></li>
                        <li><button class="btn_s"><a href="#">Connections</a></button></li>
                        <li><button class="btn_s" ><a href="#">Friend Requests</a></button></li> -->
                        
                    </div>
                    <div class="line-4">
                        <hr>
                    </div>
                <a style="font-family:Mukta"><b>APP SETTING</b></a>
                    <div class="btn_a">
                        <!-- <li><button class="btn_s"><a href="#">Appearance</a></button></li>
                        <li><button class="btn_s"><a href="#">Accessibility</a></button></li> -->
                        <li><button class="btn_s "><a href="#">Vocie & Video</a></button></li>
                        <!-- <li><button class="btn_s"><a href="#">Text & Images</a></button></li>
                        <li><button class="btn_s"><a href="#">Notifications</a></button></li>
                        <li><button class="btn_s"><a href="#">Keybinds</a></button></li>
                        <li><button class="btn_s" ><a href="#">Language</a></button></li>
                        <li><button class="btn_s" ><a href="#">Streamer Mode</a></button></li>
                        <li><button class="btn_s" ><a href="#">Advanced</a></button></li> -->
                        
                    </div>
                
        
                    <div class="line-4">
                        <hr>
                    </div>
                        <a style="font-family:Mukta"><b>Program</b></a>
                    <div class="btn_a">
                    <li ><button class="btn_s" id="logoutmenu"><a href="#">Log out</a></button></li>
                        
                        
                    </div>
                        <div class="line-4">
                            <hr>
                        </div>
                </div>
                </div>
            </div>
        
            <div class="column2">
                <div class="section_content">
                    <div class="MyAccount">
                        <a style="font-family:Mukta" class="content_head"><b>My Account</b></a>
                    </div>
                    <div class="escbtn">

                        <button type="texr" style="font-family:mukta" class="btn_out_esc" id="btn_out_esc" ><a class="iconx" ><i class="fa-solid fa-xmark"></i></a>
                            <br>
                            ESC</button>
                    </div>
                </div>
            
            </div>
        
        
            <div id="popupout">
                    
                
        
                    <div class="popup_log_content">
                        <div class="head_text"><b>Log Out</b></div>
                        <p style="font-family:mukta">Are you sure you want to logout?</p>
                    
                        
                        <div class="btn_section">
                        
                    
                        <a href="#" class="btn_cancel" id="btn_cancel_out"  style="font-family:mukta">Cancel</a>
                        <button type="text" style="font-family:mukta" class="btn_out" id="btn_out" >Log Out</button>
                        </div>
                    
                        
                        </div>
                
                
                </div>
                </section>
    </div>
    


    <div class="rootDiv" id="rootDiv">
        <div class="side-bar">
            <div id="chat-menu" class="nav">
                <!-- load chat from server or dm -->
            </div>
            <div id="user-box" class="userBox">
                <img src="https://cdn.discordapp.com/embed/avatars/0.png" alt="avatar" id="avatar" class="userAvatar">
                <div class="Username" id="userinfo">
                    <h4 id="username" class="username">Username</h4>
                    <h6 id="discriminator" class="discriminator">#1234</h6>
                </div>
                <div class="usermenuicons">
                    <div class="mic" id="micToggle"></div>
                    <div class="headphone" id="headphoneToggle"></div>
                    <div class="settings" id="settingsToggle" ></div>
                </div>
            </div>
        </div>
        <div id="nav-placeholder" class="servers">
            <!-- load navbar.html -->
            <div id="dm" class="homebutton">
                <svg class="homeIcon" aria-hidden="false" width="28" height="20" viewBox="0 0 28 20">
                    <path fill="#FFFFFF"
                        d="M20.6644 20C20.6644 20 19.8014 18.9762 19.0822 18.0714C22.2226 17.1905 23.4212 15.2381 23.4212 15.2381C22.4384 15.881 21.5034 16.3334 20.6644 16.6429C19.4658 17.1429 18.3151 17.4762 17.1884 17.6667C14.887 18.0953 12.7774 17.9762 10.9795 17.6429C9.61301 17.381 8.43836 17 7.45548 16.6191C6.90411 16.4048 6.30479 16.1429 5.70548 15.8096C5.63356 15.7619 5.56164 15.7381 5.48973 15.6905C5.44178 15.6667 5.41781 15.6429 5.39384 15.6191C4.96233 15.381 4.7226 15.2143 4.7226 15.2143C4.7226 15.2143 5.87329 17.1191 8.91781 18.0238C8.19863 18.9286 7.31164 20 7.31164 20C2.0137 19.8333 0 16.381 0 16.381C0 8.7144 3.45205 2.50017 3.45205 2.50017C6.90411 -0.07123 10.1884 0.000197861 10.1884 0.000197861L10.4281 0.285909C6.11301 1.52399 4.12329 3.40493 4.12329 3.40493C4.12329 3.40493 4.65068 3.11921 5.53767 2.71446C8.10274 1.59542 10.1404 1.2859 10.9795 1.21447C11.1233 1.19066 11.2432 1.16685 11.387 1.16685C12.8493 0.976379 14.5034 0.92876 16.2295 1.11923C18.5068 1.38114 20.9521 2.0478 23.4452 3.40493C23.4452 3.40493 21.5514 1.61923 17.476 0.381146L17.8116 0.000197861C17.8116 0.000197861 21.0959 -0.07123 24.5479 2.50017C24.5479 2.50017 28 8.7144 28 16.381C28 16.381 25.9623 19.8333 20.6644 20ZM9.51712 8.88106C8.15068 8.88106 7.07192 10.0715 7.07192 11.5239C7.07192 12.9763 8.17466 14.1667 9.51712 14.1667C10.8836 14.1667 11.9623 12.9763 11.9623 11.5239C11.9863 10.0715 10.8836 8.88106 9.51712 8.88106ZM18.2671 8.88106C16.9007 8.88106 15.8219 10.0715 15.8219 11.5239C15.8219 12.9763 16.9247 14.1667 18.2671 14.1667C19.6336 14.1667 20.7123 12.9763 20.7123 11.5239C20.7123 10.0715 19.6336 8.88106 18.2671 8.88106Z">
                    </path>
                </svg>
            </div>
            <hr class="server-divider" />
            <div id="server">
                <!-- <div class="server active">
                    <p class="servericon">SN</p>
                </div>
                <div class="server">
                    <p class="servericon">S1</p>
                </div>
                <div class="server">
                    <p class="servericon unread">S2</p>
                </div>
                <div class="server">
                    <img class="servericon" src="https://cdn.discordapp.com/embed/avatars/0.png">
                </div>
                <div class="server">
                    <img class="servericon unread" src="https://cdn.discordapp.com/embed/avatars/1.png">
                </div>
                <div class="server">
                    <img class="servericon" src="https://cdn.discordapp.com/embed/avatars/2.png">
                </div>
                <div class="server">
                    <img class="servericon" src="https://cdn.discordapp.com/embed/avatars/3.png">
                </div>
                <div class="server">
                    <img class="servericon" src="https://cdn.discordapp.com/embed/avatars/4.png">
                </div> -->
            </div>
            <div class="server invite" id="invite">
                <p class="inviteButton">+</p>
            </div>

            <div id="createserver" class="servermodal">
                <!-- Modal content -->
                <div class="modal-content">
                    <span class="close" id="closeCreateServerPopup">&times;</span>
                    <h2>Customize your server</h2>
                    <form onsubmit="return createtheserver()">

                        <div class="uploadCreateRoom">
                            <img src="{{ url_for('static', path='assets/Upload.png') }}" width="80" height="80" alt="" >
                                <div class ="round">
                                    <input type ="file">
                                    <i class="fa-solid fa-circle-plus" style="color : #fff;"></i>
                                </div>
                        </div>
                        <div class="roomnameinput">
                            <h4>SERVER NAME</h4>
                            
                            <input type="text" id="serverName" name="serverName" class="inputnameserver">
                        <br><br> <br> 
                        <div class="forbtn"> 
                            <div>

                            </div>

                            <div>
                                <input type="submit" value="Create" class="btncreate">
                            </div>
                        
                        </div>
                        
                        </div>
                        
                    </form>
                </div>
            </div>

        </div>
        <div id="chat-board" class="container">
            <!-- load chat board here -->
        </div>
        
    </div>
    
    <!-- user-box section -->
    <script src="/static/script/user-box.js" defer></script>
    <script>
        authen();
        //var t = setInterval(authen, 20000);

        async function getinfo(url) {
            let response = await fetch(url, {
                method: 'GET',
                credentials: 'include'
            })
            .then(async function (response) {
                return response.json();
            })
            .then(async function (data) {
                console.log(data);
                let username = document.getElementById("username");
                username.innerHTML = data.username;
                let avatar = document.getElementById("avatar");
                avatar.src = data.avatar;
                let discriminator = document.getElementById("discriminator");
                discriminator.innerHTML = "#" + data.tag;
            })
        }

        async function getJSON() {
            return fetch(`/account/auth`, {
                method: 'GET',
                credentials: 'include'
            })
                .then((response) => response.json())
                .then((responseJson) => { return responseJson });
        }
        async function authen() {
            url = `/account/auth`;
            const json = await this.getJSON();
            if (json.detail == "Authorized") {
                await getinfo('/account/me');
                console.log("Authorized")
            }
            else{
                window.location.href = "/account/login";
            }
        }

    </script>

    <script>

        async function get_server_list() {
            return fetch(`/server/get_list`, {
                method: 'GET',
                credentials: 'include'
            })
                .then((response) => response.json())
                .then((responseJson) => { return responseJson });
        }

        function loop_server() {
            // Get the server list data
            get_server_list().then((data) => {
                // Get the server container element
                const serverContainer = $('#server');

                // Loop through the server list data
                $.each(data.servers, (i, server) => {
                    // Create a new server element
                    const serverElement = $('<div>').addClass('server');

                    // Create a new server icon element
                    const serverIconElement = $('<img>').addClass('servericon').attr('src', server.icon);

                    // Add the server icon element to the server element
                    serverElement.append(serverIconElement);

                    // Add the server element to the server container
                    serverContainer.append(serverElement);
                });
            });
        }

        loop_server();

        var modal = document.getElementById("createserver");
        var btn = document.getElementById("invite");
        var span = document.getElementsByClassName("close")[0];
        btn.onclick = function () {
            modal.style.display = "block";
        }
        span.onclick = function () {
            modal.style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>

    <script>
         //scripy ของ setting  div
        const settingprogram = document.getElementById('settingsToggle');
        const divroot = document.getElementById('rootDiv');
        const divsetting = document.getElementById('settpage');
        const closebtnsetting = document.getElementById('btn_out_esc');
    
        settingprogram.addEventListener('click', () => {
            divroot.style.display ='none';
            divsetting.classList.add("show");
        });
    
        closebtnsetting.addEventListener('click', () => {
            divroot.style.display ='grid';
            divsetting.classList.remove("show");
        });
    
            const logoutmenu = document.getElementById('logoutmenu');
            const logoutcancel = document.getElementById('btn_cancel_out');
            const Popupout = document.getElementById('popupout');

            logoutmenu.addEventListener('click', () => {
                Popupout.style.display ='block';
            });

            logoutcancel.addEventListener('click', () => {
                Popupout.style.display ='none';
            });

        
        
        const log_out_btn = document.getElementById('btn_out');
        log_out_btn.addEventListener('click', () => {
            window.location.href = "/account/logout";
            
        });
        
        
    </script>


    
</body>

</html>